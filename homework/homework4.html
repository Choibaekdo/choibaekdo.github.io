<?php
$host = 'localhost'; // MySQL 호스트
$username = 'root'; // MySQL 사용자명
$password = ''; // MySQL 비밀번호
$database = 'ticket'; // 사용할 데이터베이스명

$conn = mysqli_connect($host, $username, $password, $database);
if (!$conn) {
    die('MySQL 연결 실패: ' . mysqli_connect_error());
}
?>
<html>
<head>
    <meta charset="utf-8">
    <title>ticket</title>
    <style>
        .input-wrap {
            width: 600px;
            margin: 0 auto;
        }
        h1 { text-align: center; }
        table {
            width: 600px;
            border: 2px solid #000;
            margin: 15 auto;
            border-collapse: collapse;  
        }
        td {
            text-align: center;
            border: 2px solid #000;
            padding: 5px;
        }
        th{
            text-align: center;
            border: 2px solid #000;
        }
        nav {
            display: inline-block;
            float: right;
        }
        p {
            display: inline-block;
        }
        ul {
            list-style: none;
            margin: 0px;
            padding: 0px; 
        }
        input {
            display: inline-block;
            text-align: center;
            margin: 20px;
            padding: 0px;
            padding-left: 10px;
            padding-right: 10px;
            text-decoration: none;
            color: black;
            border: 2px solid
        }

    </style>
</head>
<body>
    <div class="input-wrap">
        <form action="ticket.php" method="POST">
            <p>고객성명<input type="text" name="cname" style="width: 100px"></p>
            <p><input aline="right" type="submit" name="submit" value="합계"></p>
            <table>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>구분</th>
                        <th colspan="2">어린이</th>
                        <th colspan="2">어른</th>
                        <th>비고</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>입장권</td>
                        <td>7,000</td>
                        <td><select name="cent" id="cent">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            </select>
                        </td>
                        <td>10,000</td>
                        <td><select name="aent" id="aent">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            </select>
                        </td>
                        <td>입장</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>BIG3</td>
                        <td>12,000</td>
                        <td><select name="cbig" id="cbig">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            </select>
                        </td>
                        <td>16,000</td>
                        <td><select name="abig" id="abig">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            </select>
                        </td>
                        <td>입장+놀이3종</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>자유이용권</td>
                        <td>21,000</td>
                        <td><select name="cfree" id="cfree">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            </select>
                        </td>
                        <td>26,000</td>
                        <td><select name="afree" id="afree">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            </select>
                        </td>
                        <td>입장+놀이자유</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>연간이용권</td>
                        <td>70,000</td>
                        <td><select name="cyfree" id="cyfree">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            </select>
                        </td>
                        <td>90,000</td>
                        <td><select name="ayfree" id="ayfree">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            </select>
                        </td>
                        <td>입장+놀이자유</td>
                    </tr>
                </tbody>
            </table>
       </form>

        <tbody>
            <?php
                date_default_timezone_set("Asia/Seoul");
                echo date("Y년 n월 j일 H:i:s");

                if (isset($_POST['cname']) && strlen($_POST['cname']) > 0) {
                    if (isset($_POST['submit']) && $_POST['submit'] == "합계" ) {
                        $sql= "INSERT INTO tnum (cname, cent, cbig, cfree, cyfree, aent, abig, afree, ayfree) VALUES ('$_POST[cname]',  '$_POST[cent]',  '$_POST[cbig]',  '$_POST[cfree]',  '$_POST[cyfree]',  '$_POST[aent]',  '$_POST[abig]', '$_POST[afree]', '$_POST[ayfree]')";
                    }
                    mysqli_query($conn,$sql);
                }

                $query = "SELECT * FROM tnum";

                $result = mysqli_query($conn,$query) or die('Query failed: ' . mysqli_error());
                $row = mysqli_fetch_array($result);
                
                if (isset($row['cent']) > 0)
                {
                    echo "<br>", $row['cname'], " 고객님 감사합니다.<br>";
                }

                if ($row['cent'] > 0)
                {
                    echo "어린이 입장권 ", $row['cent'], "매<br>";
                }
                if ($row['cbig'] > 0)
                {
                    echo "어린이 BIG3 ", $row['cbig'], "매<br>";
                }
                if ($row['cfree'] > 0)
                {
                    echo "어린이 자유이용권권 ", $row['cfree'], "매<br>";
                }
                if ($row['cyfree'] > 0)
                {
                    echo "어린이 연간이용권권 ", $row['cyfree'], "매<br>";
                }
                if ($row['aent'] > 0)
                {
                    echo "어른 입장권 ", $row['aent'], "매<br>";
                }
                if ($row['abig'] > 0)
                {
                    echo "어른 BIG3 ", $row['abig'], "매<br>";
                }
                if ($row['afree'] > 0)
                {
                    echo "어른 자유이용권 ", $row['afree'], "매<br>";
                }
                if ($row['ayfree'] > 0)
                {
                    echo "어른 연간이용권 ", $row['ayfree'], "매<br>";
                }

                $ttotal = $row['cent'] * 7000 + $row['cbig'] * 12000 + $row['cfree'] * 21000 + $row['cyfree'] * 70000 + $row['aent'] * 10000 + $row['abig'] * 16000 + $row['afree'] * 26000 + $row['ayfree'] * 90000;

                if ($row['cent'] + $row['cbig'] + $row['cfree'] + $row['cyfree'] + $row['aent'] + $row['abig'] + $row['afree'] + $row['ayfree'] > 0)
                {
                    echo "합계 " .number_format($ttotal)."입니다.";
                }
                mysqli_free_result($result);
                mysqli_close($conn);
            ?>
        </tbody>
    </div>
</body>
</html>
